import{geojsonRbush as w}from"../geojson-rbush@7.2.0/index.js";import{square as M}from"../square@7.2.0/index.js";import{bbox as j}from"../bbox@7.2.0/index.js";import{truncate as F}from"../truncate@7.2.0/index.js";import{lineSegment as G}from"../line-segment@7.2.0/index.js";import{lineIntersect as I}from"../line-intersect@7.2.0/index.js";import{nearestPointOnLine as R}from"../nearest-point-on-line@7.2.0/index.js";import{getType as b,getCoords as m,getCoord as p}from"../invariant@7.2.0/index.js";import{flattenEach as O,featureEach as E,featureReduce as T}from"../meta@7.2.0/index.js";import{featureCollection as f,lineString as S}from"../helpers@7.2.0/index.js";function y(e,r){if(!e)throw new Error("line is required");if(!r)throw new Error("splitter is required");var t=b(e),n=b(r);if(t!=="LineString")throw new Error("line must be LineString");if(n==="FeatureCollection")throw new Error("splitter cannot be a FeatureCollection");if(n==="GeometryCollection")throw new Error("splitter cannot be a GeometryCollection");var o=F(r,{precision:7});switch(n){case"Point":return g(e,o);case"MultiPoint":return C(e,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return C(e,I(e,o,{ignoreSelfIntersections:!0}))}}function C(e,r){var t=[],n=w();return O(r,function(o){if(t.forEach(function(i,c){i.id=c}),!t.length)t=g(e,o).features,t.forEach(function(i){i.bbox||(i.bbox=M(j(i)))}),n.load(f(t));else{var a=n.search(o);if(a.features.length){var u=L(o,a);t=t.filter(function(i){return i.id!==u.id}),n.remove(u),E(g(u,o),function(i){t.push(i),n.insert(i)})}}}),f(t)}function g(e,r){var t=[],n=m(e)[0],o=m(e)[e.geometry.coordinates.length-1];if(v(n,p(r))||v(o,p(r)))return f([e]);var a=w(),u=G(e);a.load(u);var i=a.search(r);if(!i.features.length)return f([e]);var c=L(r,i),P=[n],d=T(u,function(s,x,q){var h=m(x)[1],l=p(r);return q===c.id?(s.push(l),t.push(S(s)),v(l,h)?[l]:[l,h]):(s.push(h),s)},P);return d.length>1&&t.push(S(d)),f(t)}function L(e,r){if(!r.features.length)throw new Error("lines must contain features");if(r.features.length===1)return r.features[0];var t,n=1/0;return E(r,function(o){var a=R(o,e),u=a.properties.dist;u<n&&(t=o,n=u)}),t}function v(e,r){return e[0]===r[0]&&e[1]===r[1]}var k=y;export{k as default,y as lineSplit};

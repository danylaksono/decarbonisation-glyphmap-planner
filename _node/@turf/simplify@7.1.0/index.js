import{cleanCoords as p}from"../clean-coords@7.1.0/index.js";import{clone as d}from"../clone@7.1.0/index.js";import{geomEach as g}from"../meta@7.1.0/index.js";import{isObject as m}from"../helpers@7.1.0/index.js";function v(o,i){var n=o[0]-i[0],t=o[1]-i[1];return n*n+t*t}function w(o,i,n){var t=i[0],r=i[1],e=n[0]-t,a=n[1]-r;if(e!==0||a!==0){var u=((o[0]-t)*e+(o[1]-r)*a)/(e*e+a*a);u>1?(t=n[0],r=n[1]):u>0&&(t+=e*u,r+=a*u)}return e=o[0]-t,a=o[1]-r,e*e+a*a}function y(o,i){for(var n=o[0],t=[n],r,e=1,a=o.length;e<a;e++)r=o[e],v(r,n)>i&&(t.push(r),n=r);return n!==r&&t.push(r),t}function s(o,i,n,t,r){for(var e=t,a,u=i+1;u<n;u++){var c=w(o[u],o[i],o[n]);c>e&&(a=u,e=c)}e>t&&(a-i>1&&s(o,i,a,t,r),r.push(o[a]),n-a>1&&s(o,a,n,t,r))}function b(o,i){var n=o.length-1,t=[o[0]];return s(o,0,n,i,t),t.push(o[n]),t}function l(o,i,n){if(o.length<=2)return o;var t=i!==void 0?i*i:1;return o=n?o:y(o,t),o=b(o,t),o}function f(o,i={}){var n,t,r;if(i=i??{},!m(i))throw new Error("options is invalid");const e=(n=i.tolerance)!=null?n:1,a=(t=i.highQuality)!=null?t:!1,u=(r=i.mutate)!=null?r:!1;if(!o)throw new Error("geojson is required");if(e&&e<0)throw new Error("invalid tolerance");return u!==!0&&(o=d(o)),g(o,function(c){E(c,e,a)}),o}function E(o,i,n){const t=o.type;if(t==="Point"||t==="MultiPoint")return o;if(p(o,{mutate:!0}),t!=="GeometryCollection")switch(t){case"LineString":o.coordinates=l(o.coordinates,i,n);break;case"MultiLineString":o.coordinates=o.coordinates.map(r=>l(r,i,n));break;case"Polygon":o.coordinates=h(o.coordinates,i,n);break;case"MultiPolygon":o.coordinates=o.coordinates.map(r=>h(r,i,n))}return o}function h(o,i,n){return o.map(function(t){if(t.length<4)throw new Error("invalid polygon");let r=i,e=l(t,r,n);for(;!P(e);)r-=r*.01,e=l(t,r,n);return(e[e.length-1][0]!==e[0][0]||e[e.length-1][1]!==e[0][1])&&e.push(e[0]),e})}function P(o){return o.length<3?!1:!(o.length===3&&o[2][0]===o[0][0]&&o[2][1]===o[0][1])}var k=f;export{k as default,f as simplify};

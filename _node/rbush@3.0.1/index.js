var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function J(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var q={exports:{}};(function(d,F){(function(R,x){d.exports=x()})(G,function(){function R(t,n,i,a,r){(function e(o,h,s,l,c){for(;l>s;){if(l-s>600){var u=l-s+1,p=h-s+1,y=Math.log(u),v=.5*Math.exp(2*y/3),X=.5*Math.sqrt(y*v*(u-v)/u)*(p-u/2<0?-1:1),Y=Math.max(s,Math.floor(h-p*v/u+X)),C=Math.min(l,Math.floor(h+(u-p)*v/u+X));e(o,h,Y,C,c)}var w=o[h],b=s,m=l;for(x(o,s,h),c(o[l],w)>0&&x(o,s,l);b<m;){for(x(o,b,m),b++,m--;c(o[b],w)<0;)b++;for(;c(o[m],w)>0;)m--}c(o[s],w)===0?x(o,s,m):x(o,++m,l),m<=h&&(s=m+1),h<=m&&(l=m-1)}})(t,n,i||0,a||t.length-1,r||I)}function x(t,n,i){var a=t[n];t[n]=t[i],t[i]=a}function I(t,n){return t<n?-1:t>n?1:0}var f=function(t){t===void 0&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function N(t,n,i){if(!i)return n.indexOf(t);for(var a=0;a<n.length;a++)if(i(t,n[a]))return a;return-1}function M(t,n){_(t,0,t.children.length,n,t)}function _(t,n,i,a,r){r||(r=g(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var e=n;e<i;e++){var o=t.children[e];B(r,t.leaf?a(o):o)}return r}function B(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function j(t,n){return t.minX-n.minX}function A(t,n){return t.minY-n.minY}function O(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function E(t){return t.maxX-t.minX+(t.maxY-t.minY)}function D(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function S(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function g(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function P(t,n,i,a,r){for(var e=[n,i];e.length;)if(!((i=e.pop())-(n=e.pop())<=a)){var o=n+Math.ceil((i-n)/a/2)*a;R(t,o,n,i,r),e.push(n,o,o,i)}}return f.prototype.all=function(){return this._all(this.data,[])},f.prototype.search=function(t){var n=this.data,i=[];if(!S(t,n))return i;for(var a=this.toBBox,r=[];n;){for(var e=0;e<n.children.length;e++){var o=n.children[e],h=n.leaf?a(o):o;S(t,h)&&(n.leaf?i.push(o):D(t,h)?this._all(o,i):r.push(o))}n=r.pop()}return i},f.prototype.collides=function(t){var n=this.data;if(!S(t,n))return!1;for(var i=[];n;){for(var a=0;a<n.children.length;a++){var r=n.children[a],e=n.leaf?this.toBBox(r):r;if(S(t,e)){if(n.leaf||D(t,e))return!0;i.push(r)}}n=i.pop()}return!1},f.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var n=0;n<t.length;n++)this.insert(t[n]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var a=this.data;this.data=i,i=a}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},f.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},f.prototype.clear=function(){return this.data=g([]),this},f.prototype.remove=function(t,n){if(!t)return this;for(var i,a,r,e=this.data,o=this.toBBox(t),h=[],s=[];e||h.length;){if(e||(e=h.pop(),a=h[h.length-1],i=s.pop(),r=!0),e.leaf){var l=N(t,e.children,n);if(l!==-1)return e.children.splice(l,1),h.push(e),this._condense(h),this}r||e.leaf||!D(e,o)?a?(i++,e=a.children[i],r=!1):e=null:(h.push(e),s.push(i),i=0,a=e,e=e.children[0])}return this},f.prototype.toBBox=function(t){return t},f.prototype.compareMinX=function(t,n){return t.minX-n.minX},f.prototype.compareMinY=function(t,n){return t.minY-n.minY},f.prototype.toJSON=function(){return this.data},f.prototype.fromJSON=function(t){return this.data=t,this},f.prototype._all=function(t,n){for(var i=[];t;)t.leaf?n.push.apply(n,t.children):i.push.apply(i,t.children),t=i.pop();return n},f.prototype._build=function(t,n,i,a){var r,e=i-n+1,o=this._maxEntries;if(e<=o)return M(r=g(t.slice(n,i+1)),this.toBBox),r;a||(a=Math.ceil(Math.log(e)/Math.log(o)),o=Math.ceil(e/Math.pow(o,a-1))),(r=g([])).leaf=!1,r.height=a;var h=Math.ceil(e/o),s=h*Math.ceil(Math.sqrt(o));P(t,n,i,s,this.compareMinX);for(var l=n;l<=i;l+=s){var c=Math.min(l+s-1,i);P(t,l,c,h,this.compareMinY);for(var u=l;u<=c;u+=h){var p=Math.min(u+h-1,c);r.children.push(this._build(t,u,p,a-1))}}return M(r,this.toBBox),r},f.prototype._chooseSubtree=function(t,n,i,a){for(;a.push(n),!n.leaf&&a.length-1!==i;){for(var r=1/0,e=1/0,o=void 0,h=0;h<n.children.length;h++){var s=n.children[h],l=O(s),c=(u=t,p=s,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-l);c<e?(e=c,r=l<r?l:r,o=s):c===e&&l<r&&(r=l,o=s)}n=o||n.children[0]}var u,p;return n},f.prototype._insert=function(t,n,i){var a=i?t:this.toBBox(t),r=[],e=this._chooseSubtree(a,this.data,n,r);for(e.children.push(t),B(e,a);n>=0&&r[n].children.length>this._maxEntries;)this._split(r,n),n--;this._adjustParentBBoxes(a,r,n)},f.prototype._split=function(t,n){var i=t[n],a=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,a);var e=this._chooseSplitIndex(i,r,a),o=g(i.children.splice(e,i.children.length-e));o.height=i.height,o.leaf=i.leaf,M(i,this.toBBox),M(o,this.toBBox),n?t[n-1].children.push(o):this._splitRoot(i,o)},f.prototype._splitRoot=function(t,n){this.data=g([t,n]),this.data.height=t.height+1,this.data.leaf=!1,M(this.data,this.toBBox)},f.prototype._chooseSplitIndex=function(t,n,i){for(var a,r,e,o,h,s,l,c=1/0,u=1/0,p=n;p<=i-n;p++){var y=_(t,0,p,this.toBBox),v=_(t,p,i,this.toBBox),X=(r=y,e=v,o=void 0,h=void 0,s=void 0,l=void 0,o=Math.max(r.minX,e.minX),h=Math.max(r.minY,e.minY),s=Math.min(r.maxX,e.maxX),l=Math.min(r.maxY,e.maxY),Math.max(0,s-o)*Math.max(0,l-h)),Y=O(y)+O(v);X<c?(c=X,a=p,u=Y<u?Y:u):X===c&&Y<u&&(u=Y,a=p)}return a||i-n},f.prototype._chooseSplitAxis=function(t,n,i){var a=t.leaf?this.compareMinX:j,r=t.leaf?this.compareMinY:A;this._allDistMargin(t,n,i,a)<this._allDistMargin(t,n,i,r)&&t.children.sort(a)},f.prototype._allDistMargin=function(t,n,i,a){t.children.sort(a);for(var r=this.toBBox,e=_(t,0,n,r),o=_(t,i-n,i,r),h=E(e)+E(o),s=n;s<i-n;s++){var l=t.children[s];B(e,t.leaf?r(l):l),h+=E(e)}for(var c=i-n-1;c>=n;c--){var u=t.children[c];B(o,t.leaf?r(u):u),h+=E(o)}return h},f.prototype._adjustParentBBoxes=function(t,n,i){for(var a=i;a>=0;a--)B(n[a],t)},f.prototype._condense=function(t){for(var n=t.length-1,i=void 0;n>=0;n--)t[n].children.length===0?n>0?(i=t[n-1].children).splice(i.indexOf(t[n]),1):this.clear():M(t[n],this.toBBox)},f})})(q);var T=q.exports,z=J(T);export{z as default};

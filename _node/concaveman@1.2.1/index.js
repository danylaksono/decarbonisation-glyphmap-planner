import*as R from"../rbush@3.0.1/index.js";import*as S from"../tinyqueue@2.0.3/index.js";import*as T from"../point-in-polygon@1.1.0/index.js";import*as U from"../robust-predicates@2.0.4/umd/orient2d.min.js";function V(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function b(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var D={exports:{}},W=b(R),Z=b(S),$=b(T),K=b(U),N=W,j=Z,tt=$,nt=K.orient2d;j.default&&(j=j.default),D.exports=q,D.exports.default=q;function q(t,n,r){n=Math.max(0,n===void 0?2:n),r=r||0;var a=it(t),i=new N(16);i.toBBox=function(f){return{minX:f[0],minY:f[1],maxX:f[0],maxY:f[1]}},i.compareMinX=function(f,_){return f[0]-_[0]},i.compareMinY=function(f,_){return f[1]-_[1]},i.load(t);for(var o=[],e=0,p;e<a.length;e++){var u=a[e];i.remove(u),p=G(u,p),o.push(p)}var l=new N(16);for(e=0;e<o.length;e++)l.insert(E(o[e]));for(var d=n*n,Y=r*r;o.length;){var m=o.shift(),c=m.p,x=m.next.p,h=F(c,x);if(!(h<Y)){var g=h/d;u=rt(i,m.prev.p,c,x,m.next.next.p,g,l),u&&Math.min(F(u,c),F(u,x))<=g&&(o.push(m),o.push(G(u,m)),i.remove(u),l.remove(m),l.insert(E(m)),l.insert(E(m.next)))}}m=p;var s=[];do s.push(m.p),m=m.next;while(m!==p);return s.push(m.p),s}function rt(t,n,r,a,i,o,e){for(var p=new j([],at),u=t.data;u;){for(var l=0;l<u.children.length;l++){var d=u.children[l],Y=u.leaf?I(d,r,a):ot(r,a,d);Y>o||p.push({node:d,dist:Y})}for(;p.length&&!p.peek().node.children;){var m=p.pop(),c=m.node,x=I(c,n,r),h=I(c,a,i);if(m.dist<x&&m.dist<h&&A(r,c,e)&&A(a,c,e))return c}u=p.pop(),u&&(u=u.node)}return null}function at(t,n){return t.dist-n.dist}function ot(t,n,r){if(z(t,r)||z(n,r))return 0;var a=B(t[0],t[1],n[0],n[1],r.minX,r.minY,r.maxX,r.minY);if(a===0)return 0;var i=B(t[0],t[1],n[0],n[1],r.minX,r.minY,r.minX,r.maxY);if(i===0)return 0;var o=B(t[0],t[1],n[0],n[1],r.maxX,r.minY,r.maxX,r.maxY);if(o===0)return 0;var e=B(t[0],t[1],n[0],n[1],r.minX,r.maxY,r.maxX,r.maxY);return e===0?0:Math.min(a,i,o,e)}function z(t,n){return t[0]>=n.minX&&t[0]<=n.maxX&&t[1]>=n.minY&&t[1]<=n.maxY}function A(t,n,r){for(var a=Math.min(t[0],n[0]),i=Math.min(t[1],n[1]),o=Math.max(t[0],n[0]),e=Math.max(t[1],n[1]),p=r.search({minX:a,minY:i,maxX:o,maxY:e}),u=0;u<p.length;u++)if(et(p[u].p,p[u].next.p,t,n))return!1;return!0}function y(t,n,r){return nt(t[0],t[1],n[0],n[1],r[0],r[1])}function et(t,n,r,a){return t!==a&&n!==r&&y(t,n,r)>0!=y(t,n,a)>0&&y(r,a,t)>0!=y(r,a,n)>0}function E(t){var n=t.p,r=t.next.p;return t.minX=Math.min(n[0],r[0]),t.minY=Math.min(n[1],r[1]),t.maxX=Math.max(n[0],r[0]),t.maxY=Math.max(n[1],r[1]),t}function it(t){for(var n=t[0],r=t[0],a=t[0],i=t[0],o=0;o<t.length;o++){var e=t[o];e[0]<n[0]&&(n=e),e[0]>a[0]&&(a=e),e[1]<r[1]&&(r=e),e[1]>i[1]&&(i=e)}var p=[n,r,a,i],u=p.slice();for(o=0;o<t.length;o++)tt(t[o],p)||u.push(t[o]);return pt(u)}function G(t,n){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function F(t,n){var r=t[0]-n[0],a=t[1]-n[1];return r*r+a*a}function I(t,n,r){var a=n[0],i=n[1],o=r[0]-a,e=r[1]-i;if(o!==0||e!==0){var p=((t[0]-a)*o+(t[1]-i)*e)/(o*o+e*e);p>1?(a=r[0],i=r[1]):p>0&&(a+=o*p,i+=e*p)}return o=t[0]-a,e=t[1]-i,o*o+e*e}function B(t,n,r,a,i,o,e,p){var u=r-t,l=a-n,d=e-i,Y=p-o,m=t-i,c=n-o,x=u*u+l*l,h=u*d+l*Y,g=d*d+Y*Y,s=u*m+l*c,f=d*m+Y*c,_=x*g-h*h,O,v,P,X,M=_,w=_;_===0?(v=0,M=1,X=f,w=g):(v=h*f-g*s,X=x*f-h*s,v<0?(v=0,X=f,w=g):v>M&&(v=M,X=f+h,w=g)),X<0?(X=0,-s<0?v=0:-s>x?v=M:(v=-s,M=x)):X>w&&(X=w,-s+h<0?v=0:-s+h>x?v=M:(v=-s+h,M=x)),O=v===0?0:v/M,P=X===0?0:X/w;var H=(1-O)*t+O*r,J=(1-O)*n+O*a,L=(1-P)*i+P*e,Q=(1-P)*o+P*p,k=L-H,C=Q-J;return k*k+C*C}function ut(t,n){return t[0]===n[0]?t[1]-n[1]:t[0]-n[0]}function pt(t){t.sort(ut);for(var n=[],r=0;r<t.length;r++){for(;n.length>=2&&y(n[n.length-2],n[n.length-1],t[r])<=0;)n.pop();n.push(t[r])}for(var a=[],i=t.length-1;i>=0;i--){for(;a.length>=2&&y(a[a.length-2],a[a.length-1],t[i])<=0;)a.pop();a.push(t[i])}return a.pop(),n.pop(),n.concat(a)}var mt=D.exports,lt=V(mt);export{lt as default};

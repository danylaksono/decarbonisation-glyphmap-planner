function S(e){return function(){return e}}function Y(e){return e[0]}function B(e){return e[1]}function z(){this._=null}function q(e){e.U=e.C=e.L=e.R=e.P=e.N=null}z.prototype={constructor:z,insert:function(e,r){var t,u,n;if(e){if(r.P=e,r.N=e.N,e.N&&(e.N.P=r),e.N=r,e.R){for(e=e.R;e.L;)e=e.L;e.L=r}else e.R=r;t=e}else this._?(e=F(this._),r.P=null,r.N=e,e.P=e.L=r,t=e):(r.P=r.N=null,this._=r,t=null);for(r.L=r.R=null,r.U=t,r.C=!0,e=r;t&&t.C;)u=t.U,t===u.L?(n=u.R,n&&n.C?(t.C=n.C=!1,u.C=!0,e=u):(e===t.R&&(_(this,t),e=t,t=e.U),t.C=!1,u.C=!0,$(this,u))):(n=u.L,n&&n.C?(t.C=n.C=!1,u.C=!0,e=u):(e===t.L&&($(this,t),e=t,t=e.U),t.C=!1,u.C=!0,_(this,u))),t=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var r=e.U,t,u=e.L,n=e.R,f,l;if(u?n?f=F(n):f=u:f=n,r?r.L===e?r.L=f:r.R=f:this._=f,u&&n?(l=f.C,f.C=e.C,f.L=u,u.U=f,f!==n?(r=f.U,f.U=e.U,e=f.R,r.L=e,f.R=n,n.U=f):(f.U=r,r=f,e=f.R)):(l=e.C,e=f),e&&(e.U=r),!l){if(e&&e.C){e.C=!1;return}do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,_(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){(!t.R||!t.R.C)&&(t.L.C=!1,t.C=!0,$(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,_(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,$(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){(!t.L||!t.L.C)&&(t.R.C=!1,t.C=!0,_(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,$(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}};function _(e,r){var t=r,u=r.R,n=t.U;n?n.L===t?n.L=u:n.R=u:e._=u,u.U=n,t.U=u,t.R=u.L,t.R&&(t.R.U=t),u.L=t}function $(e,r){var t=r,u=r.L,n=t.U;n?n.L===t?n.L=u:n.R=u:e._=u,u.U=n,t.U=u,t.L=u.R,t.L&&(t.L.U=t),u.R=t}function F(e){for(;e.L;)e=e.L;return e}var O=z;function k(e,r,t,u){var n=[null,null],f=b.push(n)-1;return n.left=e,n.right=r,t&&A(n,e,r,t),u&&A(n,r,e,u),U[e.index].halfedges.push(f),U[r.index].halfedges.push(f),n}function w(e,r,t){var u=[r,t];return u.left=e,u}function A(e,r,t,u){!e[0]&&!e[1]?(e[0]=u,e.left=r,e.right=t):e.left===t?e[1]=u:e[0]=u}function X(e,r,t,u,n){var f=e[0],l=e[1],s=f[0],h=f[1],a=l[0],v=l[1],o=0,c=1,g=a-s,C=v-h,i;if(i=r-s,!(!g&&i>0)){if(i/=g,g<0){if(i<o)return;i<c&&(c=i)}else if(g>0){if(i>c)return;i>o&&(o=i)}if(i=u-s,!(!g&&i<0)){if(i/=g,g<0){if(i>c)return;i>o&&(o=i)}else if(g>0){if(i<o)return;i<c&&(c=i)}if(i=t-h,!(!C&&i>0)){if(i/=C,C<0){if(i<o)return;i<c&&(c=i)}else if(C>0){if(i>c)return;i>o&&(o=i)}if(i=n-h,!(!C&&i<0)){if(i/=C,C<0){if(i>c)return;i>o&&(o=i)}else if(C>0){if(i<o)return;i<c&&(c=i)}return!(o>0)&&!(c<1)||(o>0&&(e[0]=[s+o*g,h+o*C]),c<1&&(e[1]=[s+c*g,h+c*C])),!0}}}}}function ee(e,r,t,u,n){var f=e[1];if(f)return!0;var l=e[0],s=e.left,h=e.right,a=s[0],v=s[1],o=h[0],c=h[1],g=(a+o)/2,C=(v+c)/2,i,d;if(c===v){if(g<r||g>=u)return;if(a>o){if(!l)l=[g,t];else if(l[1]>=n)return;f=[g,n]}else{if(!l)l=[g,n];else if(l[1]<t)return;f=[g,t]}}else if(i=(a-o)/(c-v),d=C-i*g,i<-1||i>1)if(a>o){if(!l)l=[(t-d)/i,t];else if(l[1]>=n)return;f=[(n-d)/i,n]}else{if(!l)l=[(n-d)/i,n];else if(l[1]<t)return;f=[(t-d)/i,t]}else if(v<c){if(!l)l=[r,i*r+d];else if(l[0]>=u)return;f=[u,i*u+d]}else{if(!l)l=[u,i*u+d];else if(l[0]<r)return;f=[r,i*r+d]}return e[0]=l,e[1]=f,!0}function te(e,r,t,u){for(var n=b.length,f;n--;)(!ee(f=b[n],e,r,t,u)||!X(f,e,r,t,u)||!(Math.abs(f[0][0]-f[1][0])>L||Math.abs(f[0][1]-f[1][1])>L))&&delete b[n]}function re(e){return U[e.index]={site:e,halfedges:[]}}function ne(e,r){var t=e.site,u=r.left,n=r.right;return t===n&&(n=u,u=t),n?Math.atan2(n[1]-u[1],n[0]-u[0]):(t===u?(u=r[1],n=r[0]):(u=r[0],n=r[1]),Math.atan2(u[0]-n[0],n[1]-u[1]))}function Q(e,r){return r[+(r.left!==e.site)]}function ue(e,r){return r[+(r.left===e.site)]}function fe(){for(var e=0,r=U.length,t,u,n,f;e<r;++e)if((t=U[e])&&(f=(u=t.halfedges).length)){var l=new Array(f),s=new Array(f);for(n=0;n<f;++n)l[n]=n,s[n]=ne(t,b[u[n]]);for(l.sort(function(h,a){return s[a]-s[h]}),n=0;n<f;++n)s[n]=u[l[n]];for(n=0;n<f;++n)u[n]=s[n]}}function se(e,r,t,u){var n=U.length,f,l,s,h,a,v,o,c,g,C,i,d,p=!0;for(f=0;f<n;++f)if(l=U[f]){for(s=l.site,a=l.halfedges,h=a.length;h--;)b[a[h]]||a.splice(h,1);for(h=0,v=a.length;h<v;)C=ue(l,b[a[h]]),i=C[0],d=C[1],o=Q(l,b[a[++h%v]]),c=o[0],g=o[1],(Math.abs(i-c)>L||Math.abs(d-g)>L)&&(a.splice(h,0,b.push(w(s,C,Math.abs(i-e)<L&&u-d>L?[e,Math.abs(c-e)<L?g:u]:Math.abs(d-u)<L&&t-i>L?[Math.abs(g-u)<L?c:t,u]:Math.abs(i-t)<L&&d-r>L?[t,Math.abs(c-t)<L?g:r]:Math.abs(d-r)<L&&i-e>L?[Math.abs(g-r)<L?c:e,r]:null))-1),++v);v&&(p=!1)}if(p){var M,R,y,j=1/0;for(f=0,p=null;f<n;++f)(l=U[f])&&(s=l.site,M=s[0]-e,R=s[1]-r,y=M*M+R*R,y<j&&(j=y,p=l));if(p){var D=[e,r],I=[e,u],J=[t,u],K=[t,r];p.halfedges.push(b.push(w(s=p.site,D,I))-1,b.push(w(s,I,J))-1,b.push(w(s,J,K))-1,b.push(w(s,K,D))-1)}}for(f=0;f<n;++f)(l=U[f])&&(l.halfedges.length||delete U[f])}var T=[],E;function le(){q(this),this.x=this.y=this.arc=this.site=this.cy=null}function N(e){var r=e.P,t=e.N;if(!(!r||!t)){var u=r.site,n=e.site,f=t.site;if(u!==f){var l=n[0],s=n[1],h=u[0]-l,a=u[1]-s,v=f[0]-l,o=f[1]-s,c=2*(h*o-a*v);if(!(c>=-ce)){var g=h*h+a*a,C=v*v+o*o,i=(o*g-a*C)/c,d=(h*C-v*g)/c,p=T.pop()||new le;p.arc=e,p.site=n,p.x=i+l,p.y=(p.cy=d+s)+Math.sqrt(i*i+d*d),e.circle=p;for(var M=null,R=m._;R;)if(p.y<R.y||p.y===R.y&&p.x<=R.x)if(R.L)R=R.L;else{M=R.P;break}else if(R.R)R=R.R;else{M=R;break}m.insert(M,p),M||(E=p)}}}}function P(e){var r=e.circle;r&&(r.P||(E=r.N),m.remove(r),T.push(r),q(r),e.circle=null)}var V=[];function ie(){q(this),this.edge=this.site=this.circle=null}function W(e){var r=V.pop()||new ie;return r.site=e,r}function G(e){P(e),x.remove(e),V.push(e),q(e)}function ae(e){var r=e.circle,t=r.x,u=r.cy,n=[t,u],f=e.P,l=e.N,s=[e];G(e);for(var h=f;h.circle&&Math.abs(t-h.circle.x)<L&&Math.abs(u-h.circle.cy)<L;)f=h.P,s.unshift(h),G(h),h=f;s.unshift(h),P(h);for(var a=l;a.circle&&Math.abs(t-a.circle.x)<L&&Math.abs(u-a.circle.cy)<L;)l=a.N,s.push(a),G(a),a=l;s.push(a),P(a);var v=s.length,o;for(o=1;o<v;++o)a=s[o],h=s[o-1],A(a.edge,h.site,a.site,n);h=s[0],a=s[v-1],a.edge=k(h.site,a.site,null,n),N(h),N(a)}function he(e){for(var r=e[0],t=e[1],u,n,f,l,s=x._;s;)if(f=Z(s,t)-r,f>L)s=s.L;else if(l=r-oe(s,t),l>L){if(!s.R){u=s;break}s=s.R}else{f>-L?(u=s.P,n=s):l>-L?(u=s,n=s.N):u=n=s;break}re(e);var h=W(e);if(x.insert(u,h),!(!u&&!n)){if(u===n){P(u),n=W(u.site),x.insert(h,n),h.edge=n.edge=k(u.site,h.site),N(u),N(n);return}if(!n){h.edge=k(u.site,h.site);return}P(u),P(n);var a=u.site,v=a[0],o=a[1],c=e[0]-v,g=e[1]-o,C=n.site,i=C[0]-v,d=C[1]-o,p=2*(c*d-g*i),M=c*c+g*g,R=i*i+d*d,y=[(d*M-g*R)/p+v,(c*R-i*M)/p+o];A(n.edge,a,C,y),h.edge=k(a,e,null,y),n.edge=k(e,C,null,y),N(u),N(n)}}function Z(e,r){var t=e.site,u=t[0],n=t[1],f=n-r;if(!f)return u;var l=e.P;if(!l)return-1/0;t=l.site;var s=t[0],h=t[1],a=h-r;if(!a)return s;var v=s-u,o=1/f-1/a,c=v/a;return o?(-c+Math.sqrt(c*c-2*o*(v*v/(-2*a)-h+a/2+n-f/2)))/o+u:(u+s)/2}function oe(e,r){var t=e.N;if(t)return Z(t,r);var u=e.site;return u[1]===r?u[0]:1/0}var L=1e-6,ce=1e-12,x,U,m,b;function ge(e,r,t){return(e[0]-t[0])*(r[1]-e[1])-(e[0]-r[0])*(t[1]-e[1])}function ve(e,r){return r[1]-e[1]||r[0]-e[0]}function H(e,r){var t=e.sort(ve).pop(),u,n,f;for(b=[],U=new Array(e.length),x=new O,m=new O;;)if(f=E,t&&(!f||t[1]<f.y||t[1]===f.y&&t[0]<f.x))(t[0]!==u||t[1]!==n)&&(he(t),u=t[0],n=t[1]),t=e.pop();else if(f)ae(f.arc);else break;if(fe(),r){var l=+r[0][0],s=+r[0][1],h=+r[1][0],a=+r[1][1];te(l,s,h,a),se(l,s,h,a)}this.edges=b,this.cells=U,x=m=b=U=null}H.prototype={constructor:H,polygons:function(){var e=this.edges;return this.cells.map(function(r){var t=r.halfedges.map(function(u){return Q(r,e[u])});return t.data=r.site.data,t})},triangles:function(){var e=[],r=this.edges;return this.cells.forEach(function(t,u){if(s=(f=t.halfedges).length)for(var n=t.site,f,l=-1,s,h,a=r[f[s-1]],v=a.left===n?a.right:a.left;++l<s;)h=v,a=r[f[l]],v=a.left===n?a.right:a.left,h&&v&&u<h.index&&u<v.index&&ge(n,h,v)<0&&e.push([n.data,h.data,v.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,r,t){for(var u=this,n,f=u._found||0,l=u.cells.length,s;!(s=u.cells[f]);)if(++f>=l)return null;var h=e-s.site[0],a=r-s.site[1],v=h*h+a*a;do s=u.cells[n=f],f=null,s.halfedges.forEach(function(o){var c=u.edges[o],g=c.left;if(!((g===s.site||!g)&&!(g=c.right))){var C=e-g[0],i=r-g[1],d=C*C+i*i;d<v&&(v=d,f=g.index)}});while(f!==null);return u._found=n,t==null||v<=t*t?s.site:null}};function Ce(){var e=Y,r=B,t=null;function u(n){return new H(n.map(function(f,l){var s=[Math.round(e(f,l,n)/L)*L,Math.round(r(f,l,n)/L)*L];return s.index=l,s.data=f,s}),t)}return u.polygons=function(n){return u(n).polygons()},u.links=function(n){return u(n).links()},u.triangles=function(n){return u(n).triangles()},u.x=function(n){return arguments.length?(e=typeof n=="function"?n:S(+n),u):e},u.y=function(n){return arguments.length?(r=typeof n=="function"?n:S(+n),u):r},u.extent=function(n){return arguments.length?(t=n==null?null:[[+n[0][0],+n[0][1]],[+n[1][0],+n[1][1]]],u):t&&[[t[0][0],t[0][1]],[t[1][0],t[1][1]]]},u.size=function(n){return arguments.length?(t=n==null?null:[[0,0],[+n[0],+n[1]]],u):t&&[t[1][0]-t[0][0],t[1][1]-t[0][1]]},u}export{Ce as voronoi};

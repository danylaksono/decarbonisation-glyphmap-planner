var k=Object.prototype.hasOwnProperty;function B(r){var n=1/0,e=1/0,c=-1/0,i=-1/0;function l(t){t!=null&&k.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(l)},Point:function(t){f(t.coordinates)},MultiPoint:function(t){t.coordinates.forEach(f)},LineString:function(t){h(t.arcs)},MultiLineString:function(t){t.arcs.forEach(h)},Polygon:function(t){t.arcs.forEach(h)},MultiPolygon:function(t){t.arcs.forEach(m)}};function f(t){var o=t[0],p=t[1];o<n&&(n=o),o>c&&(c=o),p<e&&(e=p),p>i&&(i=p)}function h(t){t.forEach(f)}function m(t){t.forEach(h)}for(var g in r)l(r[g]);return c>=n&&i>=e?[n,e,c,i]:void 0}function D(r,n,e,c,i){arguments.length===3&&(c=Array,i=null);for(var l=new c(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),s=r-1,f=0;f<r;++f)l[f]=i;function h(t){for(var o=n(t)&s,p=l[o],v=0;p!=i;){if(e(p,t))return!0;if(++v>=r)throw new Error("full hashset");p=l[o=o+1&s]}return l[o]=t,!0}function m(t){for(var o=n(t)&s,p=l[o],v=0;p!=i;){if(e(p,t))return!0;if(++v>=r)break;p=l[o=o+1&s]}return!1}function g(){for(var t=[],o=0,p=l.length;o<p;++o){var v=l[o];v!=i&&t.push(v)}return t}return{add:h,has:m,values:g}}function O(r,n,e,c,i,l){arguments.length===3&&(c=l=Array,i=null);for(var s=new c(r=1<<Math.max(4,Math.ceil(Math.log(r)/Math.LN2))),f=new l(r),h=r-1,m=0;m<r;++m)s[m]=i;function g(v,E){for(var w=n(v)&h,a=s[w],u=0;a!=i;){if(e(a,v))return f[w]=E;if(++u>=r)throw new Error("full hashmap");a=s[w=w+1&h]}return s[w]=v,f[w]=E,E}function t(v,E){for(var w=n(v)&h,a=s[w],u=0;a!=i;){if(e(a,v))return f[w];if(++u>=r)throw new Error("full hashmap");a=s[w=w+1&h]}return s[w]=v,f[w]=E,E}function o(v,E){for(var w=n(v)&h,a=s[w],u=0;a!=i;){if(e(a,v))return f[w];if(++u>=r)break;a=s[w=w+1&h]}return E}function p(){for(var v=[],E=0,w=s.length;E<w;++E){var a=s[E];a!=i&&v.push(a)}return v}return{set:g,maybeSet:t,get:o,keys:p}}function A(r,n){return r[0]===n[0]&&r[1]===n[1]}var R=new ArrayBuffer(16),T=new Float64Array(R),F=new Uint32Array(R);function j(r){T[0]=r[0],T[1]=r[1];var n=F[0]^F[1];return n=n<<5^n>>7^F[2]^F[3],n&2147483647}function J(r){var n=r.coordinates,e=r.lines,c=r.rings,i=b(),l=new Int32Array(n.length),s=new Int32Array(n.length),f=new Int32Array(n.length),h=new Int8Array(n.length),m=0,g,t,o,p,v;for(g=0,t=n.length;g<t;++g)l[g]=s[g]=f[g]=-1;for(g=0,t=e.length;g<t;++g){var E=e[g],w=E[0],a=E[1];for(p=i[w],v=i[++w],++m,h[p]=1;++w<=a;)y(g,o=p,p=v,v=i[w]);++m,h[v]=1}for(g=0,t=n.length;g<t;++g)l[g]=-1;for(g=0,t=c.length;g<t;++g){var u=c[g],M=u[0]+1,d=u[1];for(o=i[d-1],p=i[M-1],v=i[M],y(g,o,p,v);++M<=d;)y(g,o=p,p=v,v=i[M])}function y($,S,C,I){if(l[C]!==$){l[C]=$;var N=s[C];if(N>=0){var Q=f[C];(N!==S||Q!==I)&&(N!==I||Q!==S)&&(++m,h[C]=1)}else s[C]=S,f[C]=I}}function b(){for(var $=O(n.length*1.4,x,P,Int32Array,-1,Int32Array),S=new Int32Array(n.length),C=0,I=n.length;C<I;++C)S[C]=$.maybeSet(C,C);return S}function x($){return j(n[$])}function P($,S){return A(n[$],n[S])}l=s=f=null;var G=D(m*1.4,j,A),L;for(g=0,t=n.length;g<t;++g)h[L=i[g]]&&G.add(n[L]);return G}function K(r){var n=J(r),e=r.coordinates,c=r.lines,i=r.rings,l,s,f;for(s=0,f=c.length;s<f;++s)for(var h=c[s],m=h[0],g=h[1];++m<g;)n.has(e[m])&&(l={0:m,1:h[1]},h[1]=m,h=h.next=l);for(s=0,f=i.length;s<f;++s)for(var t=i[s],o=t[0],p=o,v=t[1],E=n.has(e[o]);++p<v;)n.has(e[p])&&(E?(l={0:p,1:t[1]},t[1]=p,t=t.next=l):(V(e,o,v,v-p),e[v]=e[o],E=!0,p=o));return r}function V(r,n,e,c){z(r,n,e),z(r,n,n+c),z(r,n+c,e)}function z(r,n,e){for(var c=n+(e---n>>1),i;n<c;++n,--e)i=r[n],r[n]=r[e],r[e]=i}function W(r){var n=r.coordinates,e=r.lines,c,i=r.rings,l,s=e.length+i.length,f,h;for(delete r.lines,delete r.rings,f=0,h=e.length;f<h;++f)for(c=e[f];c=c.next;)++s;for(f=0,h=i.length;f<h;++f)for(l=i[f];l=l.next;)++s;var m=O(s*2*1.4,j,A),g=r.arcs=[];for(f=0,h=e.length;f<h;++f){c=e[f];do t(c);while(c=c.next)}for(f=0,h=i.length;f<h;++f)if(l=i[f],l.next)do t(l);while(l=l.next);else o(l);function t(u){var M,d,y,b,x,P,G,L;if(y=m.get(M=n[u[0]])){for(G=0,L=y.length;G<L;++G)if(b=y[G],p(b,u)){u[0]=b[0],u[1]=b[1];return}}if(x=m.get(d=n[u[1]])){for(G=0,L=x.length;G<L;++G)if(P=x[G],v(P,u)){u[1]=P[0],u[0]=P[1];return}}y?y.push(u):m.set(M,[u]),x?x.push(u):m.set(d,[u]),g.push(u)}function o(u){var M,d,y,b,x;if(d=m.get(M=n[u[0]]))for(b=0,x=d.length;b<x;++b){if(y=d[b],E(y,u)){u[0]=y[0],u[1]=y[1];return}if(w(y,u)){u[0]=y[1],u[1]=y[0];return}}if(d=m.get(M=n[u[0]+a(u)]))for(b=0,x=d.length;b<x;++b){if(y=d[b],E(y,u)){u[0]=y[0],u[1]=y[1];return}if(w(y,u)){u[0]=y[1],u[1]=y[0];return}}d?d.push(u):m.set(M,[u]),g.push(u)}function p(u,M){var d=u[0],y=M[0],b=u[1],x=M[1];if(d-b!==y-x)return!1;for(;d<=b;++d,++y)if(!A(n[d],n[y]))return!1;return!0}function v(u,M){var d=u[0],y=M[0],b=u[1],x=M[1];if(d-b!==y-x)return!1;for(;d<=b;++d,--x)if(!A(n[d],n[x]))return!1;return!0}function E(u,M){var d=u[0],y=M[0],b=u[1],x=M[1],P=b-d;if(P!==x-y)return!1;for(var G=a(u),L=a(M),$=0;$<P;++$)if(!A(n[d+($+G)%P],n[y+($+L)%P]))return!1;return!0}function w(u,M){var d=u[0],y=M[0],b=u[1],x=M[1],P=b-d;if(P!==x-y)return!1;for(var G=a(u),L=P-a(M),$=0;$<P;++$)if(!A(n[d+($+G)%P],n[x-($+L)%P]))return!1;return!0}function a(u){for(var M=u[0],d=u[1],y=M,b=y,x=n[y];++y<d;){var P=n[y];(P[0]<x[0]||P[0]===x[0]&&P[1]<x[1])&&(b=y,x=P)}return b-M}return r}function X(r){for(var n=-1,e=r.length;++n<e;){for(var c=r[n],i=0,l=1,s=c.length,f=c[0],h=f[0],m=f[1],g,t;++i<s;)f=c[i],g=f[0],t=f[1],(g!==h||t!==m)&&(c[l++]=[g-h,t-m],h=g,m=t);l===1&&(c[l++]=[0,0]),c.length=l}return r}function Y(r){var n=-1,e=[],c=[],i=[];function l(t){t&&k.call(s,t.type)&&s[t.type](t)}var s={GeometryCollection:function(t){t.geometries.forEach(l)},LineString:function(t){t.arcs=f(t.arcs)},MultiLineString:function(t){t.arcs=t.arcs.map(f)},Polygon:function(t){t.arcs=t.arcs.map(h)},MultiPolygon:function(t){t.arcs=t.arcs.map(m)}};function f(t){for(var o=0,p=t.length;o<p;++o)i[++n]=t[o];var v={0:n-p+1,1:n};return e.push(v),v}function h(t){for(var o=0,p=t.length;o<p;++o)i[++n]=t[o];var v={0:n-p+1,1:n};return c.push(v),v}function m(t){return t.map(h)}for(var g in r)l(r[g]);return{type:"Topology",coordinates:i,lines:e,rings:c,objects:r}}function Z(r){var n={},e;for(e in r)n[e]=_(r[e]);return n}function _(r){return r==null?{type:null}:(r.type==="FeatureCollection"?q:r.type==="Feature"?U:H)(r)}function q(r){var n={type:"GeometryCollection",geometries:r.features.map(U)};return r.bbox!=null&&(n.bbox=r.bbox),n}function U(r){var n=H(r.geometry),e;r.id!=null&&(n.id=r.id),r.bbox!=null&&(n.bbox=r.bbox);for(e in r.properties){n.properties=r.properties;break}return n}function H(r){if(r==null)return{type:null};var n=r.type==="GeometryCollection"?{type:"GeometryCollection",geometries:r.geometries.map(H)}:r.type==="Point"||r.type==="MultiPoint"?{type:r.type,coordinates:r.coordinates}:{type:r.type,arcs:r.coordinates};return r.bbox!=null&&(n.bbox=r.bbox),n}function rr(r,n,e){var c=n[0],i=n[1],l=n[2],s=n[3],f=l-c?(e-1)/(l-c):1,h=s-i?(e-1)/(s-i):1;function m(a){return[Math.round((a[0]-c)*f),Math.round((a[1]-i)*h)]}function g(a,u){for(var M=-1,d=0,y=a.length,b=new Array(y),x,P,G,L,$;++M<y;)x=a[M],L=Math.round((x[0]-c)*f),$=Math.round((x[1]-i)*h),(L!==P||$!==G)&&(b[d++]=[P=L,G=$]);for(b.length=d;d<u;)d=b.push([b[0][0],b[0][1]]);return b}function t(a){return g(a,2)}function o(a){return g(a,4)}function p(a){return a.map(o)}function v(a){a!=null&&k.call(E,a.type)&&E[a.type](a)}var E={GeometryCollection:function(a){a.geometries.forEach(v)},Point:function(a){a.coordinates=m(a.coordinates)},MultiPoint:function(a){a.coordinates=a.coordinates.map(m)},LineString:function(a){a.arcs=t(a.arcs)},MultiLineString:function(a){a.arcs=a.arcs.map(t)},Polygon:function(a){a.arcs=p(a.arcs)},MultiPolygon:function(a){a.arcs=a.arcs.map(p)}};for(var w in r)v(r[w]);return{scale:[1/f,1/h],translate:[c,i]}}function nr(r,n){var e=B(r=Z(r)),c=n>0&&e&&rr(r,e,n),i=W(K(Y(r))),l=i.coordinates,s=O(i.arcs.length*1.4,tr,or);r=i.objects,i.bbox=e,i.arcs=i.arcs.map(function(o,p){return s.set(o,p),l.slice(o[0],o[1]+1)}),delete i.coordinates,l=null;function f(o){o&&k.call(h,o.type)&&h[o.type](o)}var h={GeometryCollection:function(o){o.geometries.forEach(f)},LineString:function(o){o.arcs=m(o.arcs)},MultiLineString:function(o){o.arcs=o.arcs.map(m)},Polygon:function(o){o.arcs=o.arcs.map(m)},MultiPolygon:function(o){o.arcs=o.arcs.map(g)}};function m(o){var p=[];do{var v=s.get(o);p.push(o[0]<o[1]?v:~v)}while(o=o.next);return p}function g(o){return o.map(m)}for(var t in r)f(r[t]);return c&&(i.transform=c,i.arcs=X(i.arcs)),i}function tr(r){var n=r[0],e=r[1],c;return e<n&&(c=n,n=e,e=c),n+31*e}function or(r,n){var e=r[0],c=r[1],i=n[0],l=n[1],s;return c<e&&(s=e,e=c,c=s),l<i&&(s=i,i=l,l=s),e===i&&c===l}export{nr as topology};

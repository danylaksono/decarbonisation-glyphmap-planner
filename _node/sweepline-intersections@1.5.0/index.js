class w{constructor(t=[],n=I){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:i}=this,p=n[t];for(;t>0;){const s=t-1>>1,r=n[s];if(i(p,r)>=0)break;n[t]=r,t=s}n[t]=p}_down(t){const{data:n,compare:i}=this,p=this.length>>1,s=n[t];for(;t<p;){let r=(t<<1)+1,h=n[r];const o=r+1;if(o<this.length&&i(n[o],h)<0&&(r=o,h=n[o]),i(h,s)>=0)break;n[t]=h,t=r}n[t]=s}}function I(e,t){return e<t?-1:e>t?1:0}function S(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function P(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class v{constructor(t,n,i,p){this.p={x:t[0],y:t[1]},this.featureId=n,this.ringId=i,this.eventId=p,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(t){return this.p.x===t.p.x&&this.p.y===t.p.y}}function _(e,t){if(e.type==="FeatureCollection"){const n=e.features;for(let i=0;i<n.length;i++)d(n[i],t)}else d(e,t)}let u=0,g=0,E=0;function d(e,t){const n=e.type==="Feature"?e.geometry:e;let i=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(i=[i]),n.type==="LineString"&&(i=[[i]]);for(let p=0;p<i.length;p++)for(let s=0;s<i[p].length;s++){let r=i[p][s][0],h=null;g=g+1;for(let o=0;o<i[p][s].length-1;o++){h=i[p][s][o+1];const f=new v(r,u,g,E),l=new v(h,u,g,E+1);f.otherEvent=l,l.otherEvent=f,S(f,l)>0?(l.isLeftEndpoint=!0,f.isLeftEndpoint=!1):(f.isLeftEndpoint=!0,l.isLeftEndpoint=!1),t.push(f),t.push(l),r=h,E=E+1}}u=u+1}class k{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}}function b(e,t){if(e===null||t===null||e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,i=e.leftSweepEvent.p.y,p=e.rightSweepEvent.p.x,s=e.rightSweepEvent.p.y,r=t.leftSweepEvent.p.x,h=t.leftSweepEvent.p.y,o=t.rightSweepEvent.p.x,f=t.rightSweepEvent.p.y,l=(f-h)*(p-n)-(o-r)*(s-i),y=(o-r)*(i-h)-(f-h)*(n-r),x=(p-n)*(i-h)-(s-i)*(n-r);if(l===0)return!1;const a=y/l,c=x/l;if(a>=0&&a<=1&&c>=0&&c<=1){const m=n+a*(p-n),L=i+a*(s-i);return[m,L]}return!1}function F(e,t){t=t||!1;const n=[],i=new w([],P);for(;e.length;){const p=e.pop();if(p.isLeftEndpoint){const s=new k(p);for(let r=0;r<i.data.length;r++){const h=i.data[r];if(t&&h.leftSweepEvent.featureId===p.featureId)continue;const o=b(s,h);o!==!1&&n.push(o)}i.push(s)}else p.isLeftEndpoint===!1&&i.pop()}return n}function A(e,t){const n=new w([],S);return _(e,n),F(n,t)}var B=A;export{B as default};
